name: Cleanup

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

env:
    GH_TOKEN: ${{ github.token }}

jobs:
  cleanup:
    runs-on: ubuntu-latest
    steps:
      - name: Clone
        uses: actions/checkout@v4
        with:
          path: regression

      - name: Stats
        run: |
          shopt -s dotglob
          du -hs regression/*
          shopt -u dotglob

      - name: Inviwo PRs
        working-directory: ./regression/macos/refs
        run: |
          for i in pull/*
          do 
            state=`gh pr view --json state https://github.com/inviwo/inviwo/${i} | jq -r '.state'`
            size=`du -sh ${i} | cut -f1`
            if [[ "${state}" = "ClOSED" || "${state}" = "MERGED" ]]
            then
              action="Will be removed"
            else
              action=""
            fi
            echo ${i} ${size} ${state} ${action}
          done


          
